<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Loyal Ledger</title>
  <link rel="icon" type="image/svg+xml" href="/assets/images/logo.svg" />
  <meta name="description" content="Personal blog featuring articles and songs" />
  <meta name="author" content="Stephen Anthony" />
  <meta property="og:title" content="The Loyal Ledger" />
  <meta property="og:description" content="Personal blog featuring articles and songs" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://stephen-anthony.com" />
  <meta property="og:image" content="https://stephen-anthony.com/assets/images/desk-view.jpg" />
  <meta property="og:site_name" content="The Loyal Ledger" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="The Loyal Ledger" />
  <meta name="twitter:description" content="Personal blog featuring articles and songs" />
  <meta name="twitter:image" content="https://stephen-anthony.com/assets/images/desk-view.jpg" />
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "The Loyal Ledger",
    "url": "https://stephen-anthony.com",
    "description": "Personal blog featuring articles and songs",
    "author": {
      "@type": "Person",
      "name": "Stephen Anthony"
    }
  }
  </script>
  <link rel="stylesheet" href="/style.css" />
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body class="min-h-screen bg-gray-100 p-4 flex flex-col">
  <div class="flex-1 bg-white shadow-[0_0_25px_rgba(0,0,0,0.25)]">
    <header class="border-b-2 border-stone-300 sticky top-0 bg-white z-40">
      <div class="w-full px-3 sm:px-4 lg:px-6">
        <div class="py-4 text-center border-b border-stone-200">
          <h1 class="text-3xl sm:text-4xl font-serif font-bold text-gray-900 tracking-tight">
            THE LOYAL LEDGER
          </h1>
          <p class="mt-1 text-xs text-gray-600 uppercase tracking-widest">
            A Chronicle of Thoughts & Creativity
          </p>
        </div>
        <nav class="flex justify-center" hx-target="main" hx-select="#main-content" hx-swap="innerHTML">
          <ul class="flex">
            <li>
              <a
                href="/"
                hx-get="/"
                hx-push-url="/"
                data-nav-path="/"
                class="nav-link inline-block px-6 py-3 text-xs font-medium uppercase tracking-wider transition-colors duration-200 text-gray-700"
              >
                Home
              </a>
            </li>
            <li>
              <a
                href="/blog/"
                hx-get="/blog/"
                hx-push-url="/blog/"
                data-nav-path="/blog/"
                class="nav-link inline-block px-6 py-3 text-xs font-medium uppercase tracking-wider transition-colors duration-200 text-gray-700"
              >
                Blog
              </a>
            </li>
            <li>
              <a
                href="/songs/"
                hx-get="/songs/"
                hx-push-url="/songs/"
                data-nav-path="/songs/"
                class="nav-link inline-block px-6 py-3 text-xs font-medium uppercase tracking-wider transition-colors duration-200 text-gray-700"
              >
                Songs
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="w-full px-3 sm:px-4 lg:px-6 py-6">
      <div id="main-content" class="max-w-6xl mx-auto">
        {{ content | safe }}
      </div>
    </main>
  </div>

  <script>
    function updateNavActive() {
      const currentPath = window.location.pathname;
      document.querySelectorAll('.nav-link').forEach(link => {
        const linkPath = link.getAttribute('data-nav-path');
        const isActive = currentPath === linkPath || 
                         (linkPath !== '/' && currentPath.startsWith(linkPath));
        link.classList.toggle('bg-gray-900', isActive);
        link.classList.toggle('text-white', isActive);
        link.classList.toggle('text-gray-700', !isActive);
        link.classList.toggle('hover:bg-gray-100', !isActive);
      });
    }
    function setActiveByPath(path) {
      document.querySelectorAll('.nav-link').forEach(link => {
        const linkPath = link.getAttribute('data-nav-path');
        const isActive = path === linkPath || 
                         (linkPath !== '/' && path.startsWith(linkPath));
        link.classList.toggle('bg-gray-900', isActive);
        link.classList.toggle('text-white', isActive);
        link.classList.toggle('text-gray-700', !isActive);
        link.classList.toggle('hover:bg-gray-100', !isActive);
      });
    }
    
    function balanceIndexColumns() {
      const col1 = document.getElementById('index-col-1');
      const col2 = document.getElementById('index-col-2');
      
      if (!col1 || !col2) return;
      
      const figure = col1.querySelector('figure');
      const articles = Array.from(col2.querySelectorAll('article'));
      
      if (!figure || articles.length === 0) return;
      
      const img = figure.querySelector('img');
      if (!img) return;
      
      if (!img.complete || img.naturalHeight === 0) return;
      
      const figureHeight = figure.offsetHeight;
      let col1Height = figureHeight;
      let col2Height = 0;
      
      for (let i = 0; i < articles.length; i++) {
        const article = articles[i];
        const articleHeight = article.offsetHeight;
        
        if (col2Height + articleHeight > col1Height) {
          col1.appendChild(article);
          col1Height += articleHeight;
        } else {
          col2Height += articleHeight;
        }
      }
    }
    
    function watchIndexImages() {
      const img = document.querySelector('#index-col-1 img');
      if (!img) return;
      
      if (img.complete && img.naturalHeight > 0) {
        balanceIndexColumns();
      } else {
        img.addEventListener('load', balanceIndexColumns);
      }
    }
    
    updateNavActive();
    watchIndexImages();
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', () => {
        setActiveByPath(link.getAttribute('data-nav-path'));
      });
    });
    document.body.addEventListener('htmx:pushedIntoHistory', updateNavActive);
    document.body.addEventListener('htmx:afterSwap', watchIndexImages);
  </script>
</body>
</html>